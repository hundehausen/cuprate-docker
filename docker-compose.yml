services:
  cuprate:
    image: ghcr.io/hundehausen/cuprate-docker:latest
    container_name: cuprate-node
    restart: unless-stopped
    tty: true
    stdin_open: true
    ports:
      # P2P ports
      - "18080:18080" # mainnet
      # - "28080:28080" # testnet
      # - "38080:38080" # stagenet
      # restricted RPC ports
      - "18089:18089" # mainnet
      # - "28089:28089" # testnet
      # - "38089:38089" # stagenet
    volumes:
      - cuprate-data:/home/cuprate/.local/share/cuprate
      - ./config:/home/cuprate/.config/cuprate
    command: ["--config-file", "/home/cuprate/.config/cuprate/Cuprated.toml"]
    healthcheck:
      test: ["CMD", "wget", "-q", "-O-", "http://localhost:18089/get_height"]
      interval: 60s
      timeout: 10s
      start_period: 120s
      retries: 3
    deploy:
      resources:
        limits:
          memory: 4G
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  cuprate-data:
